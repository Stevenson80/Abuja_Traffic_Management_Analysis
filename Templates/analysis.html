<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abuja Traffic Congestion Analysis - Comprehensive Report</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #4CAF50;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --border-color: #dee2e6;
            --success-color: #d4edda;
            --error-color: #f8d7da;
            --warning-color: #fff3cd;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark-color);
            line-height: 1.6;
            min-height: 100vh;
        }

        .navbar {
            background-color: white;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            text-align: center;
            box-shadow: var(--box-shadow);
        }

        .navbar a {
            margin: 0 8px;
            padding: 10px 20px;
            text-decoration: none;
            color: var(--dark-color);
            font-weight: 500;
            background-color: var(--light-color);
            border-radius: 50px;
            transition: var(--transition);
            display: inline-block;
            border: 2px solid transparent;
        }

        .navbar a:hover {
            background-color: var(--accent-color);
            color: white;
            transform: translateY(-2px);
            border-color: var(--accent-color);
        }

        .navbar a i {
            margin-right: 8px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        h1, h2, h3, h4 {
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        h1 {
            font-size: 2.5em;
            text-align: center;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        h2 {
            border-bottom: 3px solid var(--secondary-color);
            padding-bottom: 10px;
            margin-top: 30px;
        }

        h3 {
            color: var(--secondary-color);
            margin-top: 25px;
        }

        h4 {
            color: var(--primary-color);
            margin-top: 20px;
            padding-left: 10px;
            border-left: 4px solid var(--accent-color);
        }

        .flash-message {
            margin-bottom: 25px;
            padding: 15px;
            border-radius: var(--border-radius);
            border: 1px solid transparent;
        }

        .flash-message.success {
            background-color: var(--success-color);
            color: #155724;
            border-color: #c3e6cb;
        }

        .flash-message.error {
            background-color: var(--error-color);
            color: #721c24;
            border-color: #f5c6cb;
        }

        .flash-message.info {
            background-color: var(--warning-color);
            color: #856404;
            border-color: #ffeeba;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .summary-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: var(--border-radius);
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border-left: 4px solid var(--secondary-color);
            transition: var(--transition);
        }

        .summary-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .summary-card h3 {
            margin: 0 0 15px 0;
            color: var(--primary-color);
            font-size: 1.1em;
        }

        .summary-card .value {
            font-size: 1.8em;
            font-weight: bold;
            color: var(--primary-color);
            margin: 10px 0;
        }

        .summary-card .unit {
            font-size: 0.9em;
            color: #6c757d;
            margin-top: 5px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        th, td {
            border: 1px solid var(--border-color);
            padding: 12px;
            text-align: left;
        }

        th {
            background-color: var(--secondary-color);
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        tr:nth-child(even) {
            background-color: var(--light-color);
        }

        tr:hover {
            background-color: #e9ecef;
        }

        .chart-container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
            margin: 30px 0;
        }

        .chart-box {
            flex: 1 1 400px;
            min-width: 300px;
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            text-align: center;
        }

        .chart-box h4 {
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .chart-box img {
            max-width: 100%;
            height: auto;
            border-radius: var(--border-radius);
        }

        .download-btn {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 30px 0;
            justify-content: center;
        }

        .download-btn a {
            padding: 15px 25px;
            background: linear-gradient(135deg, var(--accent-color), #45a049);
            color: white;
            text-decoration: none;
            border-radius: 50px;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .download-btn a:hover {
            background: linear-gradient(135deg, #45a049, var(--accent-color));
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        .methodology {
            background: #e8f4fc;
            padding: 20px;
            border-radius: var(--border-radius);
            margin: 20px 0;
            border-left: 4px solid var(--secondary-color);
        }

        .recommendations {
            background: #f0f7ff;
            padding: 20px;
            border-radius: var(--border-radius);
            margin: 20px 0;
            border-left: 4px solid var(--accent-color);
        }

        .recommendations ul {
            padding-left: 20px;
            margin: 15px 0;
        }

        .recommendations li {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #6c757d;
            font-size: 14px;
        }

        .data-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: var(--border-radius);
            margin: 15px 0;
            font-size: 0.95em;
        }

        .road-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .road-card {
            background: var(--light-color);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .road-card h4 {
            color: var(--secondary-color);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--secondary-color);
        }

        /* Model selection styles */
        .model-selection {
            background: #f8f9fa;
            padding: 20px;
            border-radius: var(--border-radius);
            margin: 25px 0;
            border: 2px solid var(--secondary-color);
        }

        .model-selection h3 {
            margin-top: 0;
            color: var(--primary-color);
        }

        .model-form {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        .model-select {
            flex: 1;
            min-width: 200px;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 16px;
            background-color: white;
        }

        .model-submit {
            padding: 12px 24px;
            background: linear-gradient(135deg, var(--secondary-color), #2980b9);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .model-submit:hover {
            background: linear-gradient(135deg, #2980b9, var(--secondary-color));
            transform: translateY(-2px);
        }

        .model-info-box {
            margin-top: 15px;
            padding: 15px;
            background: #e8f4fc;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--secondary-color);
        }

        .model-info-box p {
            margin: 0;
            font-size: 14px;
        }

        .model-badge {
            display: inline-block;
            padding: 4px 10px;
            background: var(--secondary-color);
            color: white;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 10px;
        }

        /* Advanced parameters section */
        .advanced-params {
            background: #fff3cd;
            padding: 20px;
            border-radius: var(--border-radius);
            margin: 20px 0;
            border-left: 4px solid #ffc107;
        }

        .advanced-params h4 {
            color: #856404;
            margin-top: 0;
        }

        .param-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .param-item {
            background: white;
            padding: 12px;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .param-item strong {
            color: #856404;
            display: block;
            margin-bottom: 5px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            .navbar a {
                display: block;
                margin: 8px 0;
                text-align: center;
            }

            .summary-grid {
                grid-template-columns: 1fr;
            }

            .chart-container {
                flex-direction: column;
            }

            .chart-box {
                flex: 1 1 100%;
            }

            .download-btn {
                flex-direction: column;
                align-items: center;
            }

            .download-btn a {
                width: 100%;
                justify-content: center;
            }

            table {
                font-size: 14px;
            }

            th, td {
                padding: 8px;
            }

            .model-form {
                flex-direction: column;
                align-items: stretch;
            }

            .model-select {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 15px;
            }

            h1 {
                font-size: 2em;
            }

            .summary-card {
                padding: 15px;
            }

            .summary-card .value {
                font-size: 1.5em;
            }
        }

        .text-center {
            text-align: center;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #6c757d;
            font-style: italic;
        }

        .scrollable-table {
            overflow-x: auto;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="navbar" role="navigation" aria-label="Main navigation">
        <a href="{{ url_for('welcome') }}" aria-label="Home page"><i class="fas fa-home"></i> Home</a>
        <a href="{{ url_for('analysis') }}" aria-label="Analysis page" style="background-color: var(--accent-color); color: white;"><i class="fas fa-chart-bar"></i> Analysis</a>
        <a href="{{ url_for('data_entry') }}" aria-label="Data entry page"><i class="fas fa-pen-to-square"></i> Data Entry</a>
        <a href="{{ url_for('download_report') }}" aria-label="Download CSV report"><i class="fas fa-file-csv"></i> CSV Report</a>
        <a href="{{ url_for('download_pdf') }}" aria-label="Download PDF report"><i class="fas fa-file-pdf"></i> PDF Report</a>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-message {{ messages[0][0] }}" role="alert">
                {% for category, message in messages %}
                    <p><i class="fas fa-{% if category == 'success' %}check-circle{% else %}exclamation-circle{% endif %}"></i> {{ message }}</p>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <div class="container">
        <h1><i class="fas fa-traffic-light"></i> Comprehensive Traffic Congestion Analysis</h1>
        <p class="text-center" style="color: #6c757d; margin-bottom: 30px;">Abuja Roads: Nyanya, Lugbe, and Kubwa Corridors</p>

        <!-- Emission Model Selection -->
        <div class="model-selection">
            <h3><i class="fas fa-calculator"></i> Emission Model Selection</h3>
            <form method="get" action="{{ url_for('analysis') }}" class="model-form">
                <select name="emission_model" class="model-select" onchange="this.form.submit()">
                    {% for model in emission_models %}
                    <option value="{{ model.value }}" {% if current_emission_model == model.value %}selected{% endif %}>
                        {{ model.name }}
                    </option>
                    {% endfor %}
                </select>
                <button type="submit" class="model-submit">
                    <i class="fas fa-sync-alt"></i> Apply Model
                </button>
            </form>

            <div class="model-info-box">
                <p>
                    <span class="model-badge">{{ current_emission_model|upper }}</span>
                    {% if current_emission_model == 'basic' %}
                    Using simple fuel consumption-based emission calculations with fixed emission factors.
                    {% elif current_emission_model == 'barth' %}
                    Using Barth's comprehensive fuel consumption model with acceleration, deceleration, and idle time factors.
                    {% elif current_emission_model == 'moves' %}
                    Using EPA MOVES-like emission model with speed, acceleration, and vehicle standard corrections.
                    {% endif %}
                </p>
            </div>
        </div>

        <!-- Advanced Parameters Display -->
        {% if current_emission_model != 'basic' %}
        <div class="advanced-params">
            <h4><i class="fas fa-cogs"></i> Advanced Calculation Parameters</h4>
            <div class="param-grid">
                <div class="param-item">
                    <strong>Free Flow Speed</strong>
                    {{ summary.get('Free_Flow_Speed_KPH', 60.0) | float | format_float }} km/h
                </div>
                <div class="param-item">
                    <strong>Congested Speed</strong>
                    {{ summary.get('Congested_Speed_KPH', 8.0) | float | format_float }} km/h
                </div>
                <div class="param-item">
                    <strong>Acceleration</strong>
                    {{ summary.get('Avg_Acceleration', 0.5) | float | format_float }} m/s²
                </div>
                <div class="param-item">
                    <strong>Deceleration</strong>
                    {{ summary.get('Avg_Deceleration', 0.5) | float | format_float }} m/s²
                </div>
                <div class="param-item">
                    <strong>Idle Time</strong>
                    {{ (summary.get('Idle_Time_Percentage', 0.3) * 100) | float | format_float }}%
                </div>
            </div>
        </div>
        {% endif %}

        <div class="data-info">
            <p><strong><i class="fas fa-calendar-alt"></i> Data Entry Date:</strong> {{ summary.get('date', 'N/A') }}</p>
            <p><strong><i class="fas fa-clock"></i> Data Entry Time:</strong> {{ summary.get('time', 'N/A') }}</p>
            <p><strong><i class="fas fa-calculator"></i> Emission Model:</strong> {{ current_emission_model|upper }}</p>
            <p><strong><i class="fas fa-info-circle"></i> Note:</strong> Data represents a snapshot at {{ summary.get('time', 'N/A') }} on {{ summary.get('date', 'N/A') }}, which may not reflect daily averages.</p>
        </div>

        <h2><i class="fas fa-chart-line"></i> Executive Summary</h2>

        <div class="summary-grid">
            <div class="summary-card">
                <h3>Total Vehicles</h3>
                <div class="value">{{ summary.get('total_vehicles_all_roads', 0) | int | format_number }}</div>
                <div class="unit">across all corridors</div>
            </div>
            <div class="summary-card">
                <h3>People Affected</h3>
                <div class="value">{{ summary.get('total_people_all_roads', 0) | int | format_number }}</div>
                <div class="unit">commuters impacted</div>
            </div>
            <div class="summary-card">
                <h3>Total Delay</h3>
                <div class="value">{{ summary.get('total_delay_hours_all_roads', 0.0) | float | format_float }}</div>
                <div class="unit">hours lost</div>
            </div>
            <div class="summary-card">
                <h3>Economic Impact</h3>
                <div class="value">₦{{ (summary.get('total_fuel_cost_all_roads', 0.0) + summary.get('total_productivity_loss_all_roads', 0.0)) | float | format_number }}</div>
                <div class="unit">fuel + productivity loss</div>
            </div>
        </div>

        <h2><i class="fas fa-calculator"></i> Methodology</h2>
        <div class="methodology">
            <p>This analysis uses vehicle-specific occupancy rates and fuel consumption parameters with the following key assumptions:</p>
            <ul>
                <li><strong>Fuel Prices:</strong> ₦{{ summary.get('Fuel_Cost_Per_Liter_Petrol', 850.0) | float | format_currency }}/L (petrol), ₦{{ summary.get('Fuel_Cost_Per_Liter_Diesel', 1000.0) | float | format_currency }}/L (diesel)</li>
                <li><strong>Emission Factors:</strong> {{ summary.get('Emission_Factor_Petrol', 2.31) | float | format_float }} kg CO₂/L (petrol), {{ summary.get('Emission_Factor_Diesel', 2.68) | float | format_float }} kg CO₂/L (diesel)</li>
                <li><strong>Productivity Value:</strong> ₦{{ summary.get('Value_Per_Minute_Naira', 7.29) | float | format_currency }}/minute based on minimum wage calculations</li>
                <li><strong>Corridor Length:</strong> {{ summary.get('Distance_KM', 6.0) | float | format_float }} km average distance</li>
                <li><strong>Time Parameters:</strong> Free flow: {{ summary.get('Free_Flow_Time_Minutes', 4.0) | float | format_float }} min, Congested: {{ summary.get('Congested_Travel_Time_Minutes', 45.0) | float | format_float }} min</li>
                {% if current_emission_model != 'basic' %}
                <li><strong>Advanced Parameters:</strong>
                    Free flow speed: {{ summary.get('Free_Flow_Speed_KPH', 60.0) | float | format_float }} km/h,
                    Congested speed: {{ summary.get('Congested_Speed_KPH', 8.0) | float | format_float }} km/h,
                    Acceleration: {{ summary.get('Avg_Acceleration', 0.5) | float | format_float }} m/s²,
                    Idle time: {{ (summary.get('Idle_Time_Percentage', 0.3) * 100) | float | format_float }}%
                </li>
                {% endif %}
                <li><strong>Emission Model:</strong> {{ current_emission_model|upper }}</li>
            </ul>
        </div>

        <h2><i class="fas fa-chart-bar"></i> Grand Totals Across All Roads</h2>
        <div class="scrollable-table">
            <table role="grid" aria-label="Summary of traffic metrics across all roads">
                <thead>
                    <tr>
                        <th>Performance Metric</th>
                        <th>Value</th>
                        <th>Unit</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Total Vehicles Observed</td>
                        <td>{{ summary.get('total_vehicles_all_roads', 0) | int | format_number }}</td>
                        <td>vehicles</td>
                    </tr>
                    <tr>
                        <td>Total People Affected</td>
                        <td>{{ summary.get('total_people_all_roads', 0) | int | format_number }}</td>
                        <td>people</td>
                    </tr>
                    <tr>
                        <td>Total Delay Time</td>
                        <td>{{ summary.get('total_delay_hours_all_roads', 0.0) | float | format_float }}</td>
                        <td>hours</td>
                    </tr>
                    <tr>
                        <td>Total Excess Fuel Consumption</td>
                        <td>{{ summary.get('total_excess_fuel_all_roads', 0.0) | float | format_float }}</td>
                        <td>liters</td>
                    </tr>
                    <tr>
                        <td>Total Fuel Cost</td>
                        <td>{{ summary.get('total_fuel_cost_all_roads', 0.0) | float | format_currency }}</td>
                        <td>naira</td>
                    </tr>
                    <tr>
                        <td>Average Fuel Cost per Vehicle</td>
                        <td>{{ summary.get('avg_fuel_cost_per_vehicle', 0.0) | float | format_currency }}</td>
                        <td>naira/vehicle</td>
                    </tr>
                    <tr>
                        <td>Total CO2 Emissions</td>
                        <td>{{ summary.get('total_co2_all_roads', 0.0) | float | format_float }}</td>
                        <td>kg</td>
                    </tr>
                    <tr>
                        <td>Total Productivity Loss</td>
                        <td>{{ summary.get('total_productivity_loss_all_roads', 0.0) | float | format_currency }}</td>
                        <td>naira</td>
                    </tr>
                    <tr style="background-color: #e3f2fd;">
                        <td><strong>Total Economic Impact</strong></td>
                        <td><strong>₦{{ (summary.get('total_fuel_cost_all_roads', 0.0) + summary.get('total_productivity_loss_all_roads', 0.0)) | float | format_number }}</strong></td>
                        <td><strong>naira</strong></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <h2><i class="fas fa-road"></i> Per-Road Analysis</h2>
        <div class="road-comparison">
            {% for road_name, road_data in road_results.items() %}
            <div class="road-card">
                <h4>{{ road_name }}</h4>
                <table>
                    <tr>
                        <td>Vehicles</td>
                        <td>{{ road_data.get('total_vehicles', 0) | int | format_number }}</td>
                    </tr>
                    <tr>
                        <td>People Affected</td>
                        <td>{{ road_data.get('total_people', 0) | int | format_number }}</td>
                    </tr>
                    <tr>
                        <td>Excess Fuel</td>
                        <td>{{ road_data.get('total_excess_fuel_l', 0.0) | float | format_float }} L</td>
                    </tr>
                    <tr>
                        <td>Fuel Cost</td>
                        <td>{{ road_data.get('total_fuel_cost_naira', 0.0) | float | format_currency }}</td>
                    </tr>
                    <tr>
                        <td>CO2 Emissions</td>
                        <td>{{ road_data.get('total_co2_kg', 0.0) | float | format_float }} kg</td>
                    </tr>
                    <tr>
                        <td>Productivity Loss</td>
                        <td>{{ road_data.get('total_productivity_loss_naira', 0.0) | float | format_currency }}</td>
                    </tr>
                    <tr style="background-color: #e8f4fc;">
                        <td><strong>Total Impact</strong></td>
                        <td><strong>₦{{ (road_data.get('total_fuel_cost_naira', 0.0) + road_data.get('total_productivity_loss_naira', 0.0)) | float | format_number }}</strong></td>
                    </tr>
                </table>
            </div>
            {% endfor %}
        </div>

        <h2><i class="fas fa-chart-pie"></i> Vehicle Distribution Analysis</h2>
        <p>The pie charts below illustrate the distribution of vehicle types across each road corridor:</p>

        <div class="chart-container">
            {% for road_name in vehicle_distributions.keys() %}
            <div class="chart-box">
                <h4>{{ road_name }}</h4>
                {% if chart_images.get('pie_' + road_name.replace(' ', '_')) %}
                    <img src="{{ chart_images['pie_' + road_name.replace(' ', '_')] }}" alt="Pie chart showing vehicle distribution for {{ road_name }}" aria-label="Pie chart for {{ road_name }}">
                {% else %}
                    <div class="no-data">
                        <i class="fas fa-exclamation-triangle" style="font-size: 2em; margin-bottom: 10px;"></i>
                        <p>Chart not available for {{ road_name }}</p>
                    </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>

        <h2><i class="fas fa-chart-bar"></i> Comparative Analysis</h2>
        <p>The following charts compare key metrics across the three road corridors:</p>

        <div class="chart-container">
            {% set chart_titles = {
                'people': 'People Affected by Congestion',
                'fuel': 'Excess Fuel Consumption (Liters)',
                'co2': 'CO2 Emissions (kg)',
                'cost': 'Total Cost (Fuel + Productivity Loss)',
                'avg_fuel_cost': 'Average Fuel Cost per Vehicle'
            } %}

            {% for chart_id, chart_title in chart_titles.items() %}
            <div class="chart-box">
                <h4>{{ chart_title }}</h4>
                {% if chart_images.get(chart_id) %}
                    <img src="{{ chart_images[chart_id] }}" alt="Bar chart for {{ chart_title }}" aria-label="{{ chart_title }} chart">
                {% else %}
                    <div class="no-data">
                        <i class="fas fa-exclamation-triangle" style="font-size: 2em; margin-bottom: 10px;"></i>
                        <p>{{ chart_title }} chart not available</p>
                    </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>

        <h2><i class="fas fa-file-alt"></i> Detailed Report Data</h2>
        <div class="scrollable-table">
            <table role="grid" aria-label="Detailed traffic congestion report">
                <thead>
                    <tr>
                        <th>Road</th>
                        <th>Vehicle Type</th>
                        <th>Count</th>
                        <th>People</th>
                        <th>Delay (min)</th>
                        <th>Excess Fuel (L)</th>
                        <th>Fuel Cost (₦)</th>
                        <th>CO2 (kg)</th>
                        <th>Productivity Loss (₦)</th>
                        <th>Emission Model</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in report_data | default([]) %}
                    <tr>
                        <td>{{ row.get('Road', 'N/A') }}</td>
                        <td>{{ row.get('Vehicle Type', 'N/A') }}</td>
                        <td>{{ row.get('Vehicle Count', 0) | int | format_number }}</td>
                        <td>{{ row.get('People Affected', 0) | int | format_number }}</td>
                        <td>{{ row.get('Delay per Vehicle (min)', 0.0) | float | format_float }}</td>
                        <td>{{ row.get('Total Excess Fuel (L)', 0.0) | float | format_float }}</td>
                        <td>{{ row.get('Fuel Cost (₦)', 0.0) | float | format_currency }}</td>
                        <td>{{ row.get('CO2 Emissions (kg)', 0.0) | float | format_float }}</td>
                        <td>{{ row.get('Productivity Loss (₦)', 0.0) | float | format_currency }}</td>
                        <td>{{ row.get('Emission Model', current_emission_model|upper) }}</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="10" class="no-data">No report data available</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <h2><i class="fas fa-lightbulb"></i> Recommendations</h2>
        <div class="recommendations">
            <p>Based on the traffic congestion analysis, the following interventions are recommended:</p>
            <ul>
                <li><strong>Traffic Management:</strong> Implement intelligent traffic management systems to reduce congestion during peak hours</li>
                <li><strong>Public Transportation:</strong> Enhance alternative transportation options to reduce private vehicle numbers</li>
                <li><strong>Infrastructure Investment:</strong> Prioritize road improvements based on specific congestion patterns</li>
                <li><strong>Carpooling Promotion:</strong> Encourage ridesharing to increase vehicle occupancy rates</li>
                <li><strong>Congestion Pricing:</strong> Consider implementing congestion pricing during peak hours</li>
                <li><strong>Environmental Mitigation:</strong> Develop strategies to offset CO2 emissions from traffic congestion</li>
                <li><strong>Model Selection:</strong> Continue using {{ current_emission_model|upper }} model for future analyses to maintain consistency in emission calculations</li>
            </ul>
        </div>

        <div class="download-btn">
            <a href="{{ url_for('download_report') }}?emission_model={{ current_emission_model }}" aria-label="Download CSV report"><i class="fas fa-file-csv"></i> Download CSV Report</a>
            <a href="{{ url_for('download_pdf') }}?emission_model={{ current_emission_model }}" aria-label="Download PDF report"><i class="fas fa-file-pdf"></i> Download PDF Report</a>
            <a href="{{ url_for('download_traffic_data') }}" aria-label="Download input data as CSV"><i class="fas fa-download"></i> Download Input Data</a>
            <a href="{{ url_for('data_entry') }}" aria-label="Enter new traffic data"><i class="fas fa-pen-to-square"></i> Enter New Data</a>
        </div>
    </div>

    <footer>
        <p>© 2025 | Powered by Opygoal Technology Ltd | Developed by Oladotun Ajakaiye | Service Manager & Data Analyst</p>
    </footer>
</body>
</html>