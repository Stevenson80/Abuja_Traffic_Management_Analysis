<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abuja Traffic Analysis Report</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #1a2a6c;
            --secondary-color: #b21f1f;
            --accent-color: #fdbb2d;
            --light-color: #f0f7ff;
            --dark-color: #2c3e50;
            --border-color: #dee2e6;
            --text-color: #333;
            --border-radius: 8px;
            --box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
        }

        .cover-page {
            text-align: center;
            padding: 80px 40px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color), var(--accent-color));
            color: white;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
        }

        .cover-page h1 {
            font-size: 2.8em;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .cover-page p {
            font-size: 1.2em;
            max-width: 800px;
            margin: 10px auto;
            opacity: 0.9;
        }

        .cover-page .date {
            margin-top: 30px;
            font-size: 1.1em;
            font-weight: 500;
        }

        .section {
            background: white;
            padding: 30px;
            margin-bottom: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            page-break-inside: avoid;
        }

        h1, h2, h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        h2 {
            border-bottom: 3px solid var(--accent-color);
            padding-bottom: 10px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .summary-card {
            background: var(--light-color);
            padding: 20px;
            border-radius: var(--border-radius);
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border-left: 4px solid var(--primary-color);
            transition: transform 0.3s ease;
        }

        .summary-card:hover {
            transform: translateY(-3px);
        }

        .summary-card h3 {
            margin-top: 0;
            margin-bottom: 15px;
            color: var(--dark-color);
            font-size: 1.1em;
        }

        .summary-card .value {
            font-size: 1.8em;
            font-weight: bold;
            color: var(--primary-color);
            margin: 10px 0;
        }

        .summary-card .unit {
            font-size: 0.9em;
            color: #6c757d;
            margin-top: 5px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        tr:hover {
            background-color: #e9ecef;
        }

        .chart-container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
            margin: 30px 0;
        }

        .chart-box {
            flex: 1 1 400px;
            min-width: 300px;
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            border: 1px solid var(--border-color);
        }

        .chart-box h3 {
            text-align: center;
            margin-bottom: 20px;
            color: var(--dark-color);
        }

        .footer {
            text-align: center;
            margin-top: 50px;
            padding: 30px;
            color: #6c757d;
            font-size: 0.95em;
            border-top: 1px solid var(--border-color);
        }

        .methodology {
            background: #e8f4fc;
            padding: 20px;
            border-radius: var(--border-radius);
            margin: 20px 0;
            border-left: 4px solid var(--primary-color);
        }

        .methodology ul {
            padding-left: 20px;
            margin: 15px 0;
        }

        .methodology li {
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .recommendations {
            background: #f0f7ff;
            padding: 20px;
            border-radius: var(--border-radius);
            margin: 20px 0;
            border-left: 4px solid var(--accent-color);
        }

        .recommendations ul {
            padding-left: 20px;
            margin: 15px 0;
        }

        .recommendations li {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .road-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .road-card {
            background: var(--light-color);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .road-card h3 {
            color: var(--secondary-color);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--secondary-color);
        }

        @media print {
            body {
                padding: 0;
                background-color: white;
                font-size: 12pt;
            }
            .section {
                box-shadow: none;
                border: 1px solid #ddd;
                page-break-inside: avoid;
            }
            .cover-page {
                page-break-after: always;
                box-shadow: none;
            }
            .summary-card, .road-card {
                box-shadow: none;
                border: 1px solid #ddd;
            }
            .chart-box {
                page-break-inside: avoid;
            }
            table {
                page-break-inside: avoid;
            }
        }

        @media (max-width: 768px) {
            .cover-page {
                padding: 60px 20px;
            }
            .cover-page h1 {
                font-size: 2.2em;
            }
            .summary-grid {
                grid-template-columns: 1fr;
            }
            .chart-container {
                flex-direction: column;
            }
            .chart-box {
                flex: 1 1 100%;
            }
            .road-comparison {
                grid-template-columns: 1fr;
            }
        }

        .text-center {
            text-align: center;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .scrollable-table {
            overflow-x: auto;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <!-- Cover Page -->
    <div class="cover-page">
        <h1>Abuja Traffic Analysis System</h1>
        <p>Comprehensive traffic congestion analysis for major Abuja roads</p>
        <p>Detailed assessment of economic and environmental impacts</p>
        <div class="date">Report Generated: {{ current_date | default('August 29, 2025') }}</div>
    </div>

    <!-- Executive Summary -->
    <div class="section">
        <h2>Executive Summary</h2>
        <p>This report presents a comprehensive analysis of traffic congestion across three major Abuja roads: Nyanya, Lugbe, and Kubwa. The analysis captures data from <strong>{{ summary.total_vehicles_all_roads | default(409, true) | format_number }}</strong> vehicles during evening rush hour (18:00) on {{ summary.date | default('August 29, 2025') }}, quantifying the economic and environmental impact of congestion through multiple metrics including delay times, fuel consumption, CO2 emissions, and productivity loss.</p>

        <div class="summary-grid">
            <div class="summary-card">
                <h3>Total Vehicles</h3>
                <div class="value">{{ summary.total_vehicles_all_roads | default(409, true) | format_number }}</div>
                <div class="unit">across all corridors</div>
            </div>
            <div class="summary-card">
                <h3>People Affected</h3>
                <div class="value">{{ summary.total_people_all_roads | default(1975, true) | format_number }}</div>
                <div class="unit">commuters impacted</div>
            </div>
            <div class="summary-card">
                <h3>Total Delay</h3>
                <div class="value">{{ summary.total_delay_hours_all_roads | default(279.5, true) | format_float }}</div>
                <div class="unit">hours lost</div>
            </div>
            <div class="summary-card">
                <h3>Economic Impact</h3>
                <div class="value">â‚¦{{ (summary.total_fuel_cost_all_roads | default(117907.5, true) + summary.total_productivity_loss_all_roads | default(487286.03, true)) | format_number }}</div>
                <div class="unit">fuel + productivity loss</div>
            </div>
        </div>

        <p>The analysis reveals significant congestion across all three corridors, with Nyanya Road experiencing the highest impact in terms of vehicles affected, fuel cost, and productivity loss. The findings highlight the urgent need for targeted interventions to alleviate traffic congestion and its associated economic and environmental costs.</p>
    </div>

    <!-- Methodology -->
    <div class="section">
        <h2>Methodology</h2>
        <div class="methodology">
            <p>This analysis uses vehicle-specific occupancy rates and fuel consumption parameters. Key assumptions include:</p>
            <ul>
                <li><strong>Fuel prices:</strong> â‚¦{{ summary.Fuel_Cost_Per_Liter_Petrol | default(850.0, true) | format_float }}/L for petrol and â‚¦{{ summary.Fuel_Cost_Per_Liter_Diesel | default(1000.0, true) | format_float }}/L for diesel</li>
                <li><strong>CO2 emission factors:</strong> {{ summary.Emission_Factor_Petrol | default(2.31, true) | format_float }} kg COâ‚‚/L for petrol and {{ summary.Emission_Factor_Diesel | default(2.68, true) | format_float }} kg COâ‚‚/L for diesel</li>
                <li><strong>Productivity Loss</strong> calculated using a value of time of â‚¦{{ summary.Value_Per_Minute_Naira | default(7.29, true) | format_float }}/minute, based on minimum wage calculations</li>
                <li><strong>Data represents</strong> a snapshot at {{ summary.time | default('18:00', true) }} on {{ summary.date | default('2025-08-29', true) }}, which may not reflect daily averages</li>
                <li><strong>Corridor Length:</strong> {{ summary.Distance_KM | default(6.0, true) | format_float }} km average distance</li>
            </ul>
        </div>
    </div>

    <!-- Grand Totals -->
    <div class="section">
        <h2>Grand Totals Across All Roads</h2>
        <div class="scrollable-table">
            <table>
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Value</th>
                        <th>Unit</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Total Vehicles</td>
                        <td>{{ summary.total_vehicles_all_roads | default(409, true) | format_number }}</td>
                        <td>vehicles</td>
                    </tr>
                    <tr>
                        <td>Total People Affected</td>
                        <td>{{ summary.total_people_all_roads | default(1975, true) | format_number }}</td>
                        <td>people</td>
                    </tr>
                    <tr>
                        <td>Total Delay Time</td>
                        <td>{{ summary.total_delay_hours_all_roads | default(279.5, true) | format_float }}</td>
                        <td>hours</td>
                    </tr>
                    <tr>
                        <td>Total Excess Fuel</td>
                        <td>{{ summary.total_excess_fuel_all_roads | default(133.9, true) | format_float }}</td>
                        <td>liters</td>
                    </tr>
                    <tr>
                        <td>Total Fuel Cost</td>
                        <td>â‚¦{{ summary.total_fuel_cost_all_roads | default(117907.5, true) | format_number }}</td>
                        <td>naira</td>
                    </tr>
                    <tr>
                        <td>Total CO2 Emissions</td>
                        <td>{{ summary.total_co2_all_roads | default(319.5, true) | format_float }}</td>
                        <td>kg</td>
                    </tr>
                    <tr>
                        <td>Total Productivity Loss</td>
                        <td>â‚¦{{ summary.total_productivity_loss_all_roads | default(487286.03, true) | format_number }}</td>
                        <td>naira</td>
                    </tr>
                    <tr style="background-color: #e3f2fd;">
                        <td><strong>Total Economic Impact</strong></td>
                        <td><strong>â‚¦{{ (summary.total_fuel_cost_all_roads | default(117907.5, true) + summary.total_productivity_loss_all_roads | default(487286.03, true)) | format_number }}</strong></td>
                        <td><strong>naira</strong></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Per-Road Analysis -->
    <div class="section">
        <h2>Per-Road Analysis</h2>
        <div class="road-comparison">
            {% for road_name, road_data in road_results.items() %}
            <div class="road-card">
                <h3>{{ road_name }}</h3>
                <table>
                    <tr>
                        <td>Vehicles</td>
                        <td>{{ road_data.total_vehicles | default(0) | format_number }}</td>
                    </tr>
                    <tr>
                        <td>People Affected</td>
                        <td>{{ road_data.total_people | default(0) | format_number }}</td>
                    </tr>
                    <tr>
                        <td>Excess Fuel</td>
                        <td>{{ road_data.total_excess_fuel_l | default(0.0) | format_float }} L</td>
                    </tr>
                    <tr>
                        <td>Fuel Cost</td>
                        <td>â‚¦{{ road_data.total_fuel_cost_naira | default(0.0) | format_number }}</td>
                    </tr>
                    <tr>
                        <td>CO2 Emissions</td>
                        <td>{{ road_data.total_co2_kg | default(0.0) | format_float }} kg</td>
                    </tr>
                    <tr>
                        <td>Productivity Loss</td>
                        <td>â‚¦{{ road_data.total_productivity_loss_naira | default(0.0) | format_number }}</td>
                    </tr>
                    <tr style="background-color: #e8f4fc;">
                        <td><strong>Total Impact</strong></td>
                        <td><strong>â‚¦{{ (road_data.total_fuel_cost_naira | default(0.0) + road_data.total_productivity_loss_naira | default(0.0)) | format_number }}</strong></td>
                    </tr>
                </table>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Vehicle Distribution Charts -->
    <div class="section">
        <h2>Vehicle Distribution Analysis</h2>
        <p>The following pie charts illustrate the distribution of vehicle types across each road corridor:</p>

        <div class="chart-container">
            {% for road_name in vehicle_distributions.keys() %}
            <div class="chart-box">
                <h3>{{ road_name }} Vehicle Distribution</h3>
                <canvas id="pie-{{ road_name | replace(' ', '-') | lower }}"></canvas>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Comparative Analysis -->
    <div class="section">
        <h2>Comparative Analysis Across Roads</h2>
        <p>The following bar charts compare key metrics across the three road corridors:</p>

        <div class="chart-container">
            <div class="chart-box">
                <h3>People Affected by Congestion</h3>
                <canvas id="peopleChart"></canvas>
            </div>
            <div class="chart-box">
                <h3>Fuel Cost Comparison (â‚¦)</h3>
                <canvas id="fuelCostChart"></canvas>
            </div>
            <div class="chart-box">
                <h3>Productivity Loss (â‚¦)</h3>
                <canvas id="productivityChart"></canvas>
            </div>
            <div class="chart-box">
                <h3>CO2 Emissions (kg)</h3>
                <canvas id="co2Chart"></canvas>
            </div>
        </div>
    </div>

    <!-- Conclusions -->
    <div class="section">
        <h2>Conclusions and Recommendations</h2>

        <div class="methodology mb-20">
            <h3>Key Findings</h3>
            <ul>
                <li>Nyanya Road shows the highest congestion impact, accounting for approximately 42% of total vehicles and 51% of productivity losses</li>
                <li>Evening rush hour congestion affects nearly 2,000 commuters across the three corridors</li>
                <li>Total economic impact exceeds â‚¦600,000 during the observed period</li>
                <li>Environmental impact includes {{ summary.total_co2_all_roads | default(319.5, true) | format_float }} kg of excess CO2 emissions</li>
                <li>Average delay per vehicle is {{ summary.avg_delay_per_vehicle | default(41.0, true) | format_float }} minutes across all corridors</li>
            </ul>
        </div>

        <div class="recommendations">
            <h3>Strategic Recommendations</h3>
            <ul>
                <li><strong>Immediate Interventions:</strong> Implement targeted traffic management systems on Nyanya Road, which shows the highest congestion metrics</li>
                <li><strong>Public Transportation:</strong> Enhance alternative transportation options to reduce private vehicle numbers during peak hours</li>
                <li><strong>Infrastructure Investment:</strong> Prioritize road improvements based on specific vehicle type distributions observed</li>
                <li><strong>Policy Measures:</strong> Consider congestion pricing or staggered work hours to distribute traffic more evenly</li>
                <li><strong>Data Collection:</strong> Expand monitoring to understand daily and weekly patterns beyond current snapshot data</li>
                <li><strong>Environmental Mitigation:</strong> Implement measures to offset {{ summary.total_co2_all_roads | default(319.5, true) | format_float }} kg of CO2 emissions generated</li>
            </ul>
        </div>
    </div>

    <div class="footer">
        <p>Â© 2025 | Powered by Opygoal Technology Ltd | Developed by Oladotun Ajakaiye | Service Manager & Data Analyst</p>
    </div>

    <script>
        // Initialize charts when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Sample data - in a real application, this would come from your backend
            const roadNames = ['Nyanya Road', 'Lugbe Road', 'Kubwa Road'];
            const vehicleTypes = ['Cars', 'Motorcycles', 'SUVs', 'Sedans', 'Wagons', 'Short Buses', 'Minibusses', 'Long Buses', 'Truck', 'Tanker and Trailer'];

            // Generate pie charts for each road
            roadNames.forEach(road => {
                const canvasId = `pie-${road.replace(' ', '-').toLowerCase()}`;
                const ctx = document.getElementById(canvasId);

                if (ctx) {
                    // Generate random data for demonstration
                    const data = Array.from({length: 5}, () => Math.floor(Math.random() * 30) + 10);

                    new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: vehicleTypes.slice(0, 5),
                            datasets: [{
                                data: data,
                                backgroundColor: ['#1a2a6c', '#b21f1f', '#fdbb2d', '#1c6b3d', '#6b2c90', '#2a6b55', '#6b2c4d', '#4d2c6b', '#6b4d2c', '#2c6b6b']
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: {
                                        boxWidth: 12,
                                        font: {
                                            size: 10
                                        }
                                    }
                                },
                                title: {
                                    display: false
                                }
                            }
                        }
                    });
                }
            });

            // Bar charts for comparative analysis
            const barChartData = {
                'People Affected': [835, 681, 458],
                'Fuel Cost': [50377, 40492, 27037],
                'Productivity Loss': [249752, 100492, 137041],
                'CO2 Emissions': [136.5, 109.7, 73.3]
            };

            Object.keys(barChartData).forEach((metric, index) => {
                const ctx = document.getElementById([
                    'peopleChart',
                    'fuelCostChart',
                    'productivityChart',
                    'co2Chart'
                ][index]);

                if (ctx) {
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: roadNames,
                            datasets: [{
                                label: metric,
                                data: barChartData[metric],
                                backgroundColor: ['#1a2a6c', '#b21f1f', '#fdbb2d']
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            if (metric === 'Fuel Cost' || metric === 'Productivity Loss') {
                                                return 'â‚¦' + value.toLocaleString();
                                            } else if (metric === 'CO2 Emissions') {
                                                return value + ' kg';
                                            }
                                            return value;
                                        }
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false
                                }
                            }
                        }
                    });
                }
            });
        });
    </script>
</body>
</html>